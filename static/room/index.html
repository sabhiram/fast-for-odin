<!DOCTYPE html>
<html lang="en">
<head>
  <title>Tempus Fugit!</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0 maximum-scale=1.0, user-scalable=no" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

  <!-- Web components needed for Polymer -->
  <script src="/external/webcomponentsjs/webcomponents-lite.js"></script>
  <script src="/external/socket.io/socket.io-1.3.7.min.js"></script>

  <link rel="import" href="/external/polymer/polymer.html" />
  <link rel="import" href="/external/iron-location/iron-location.html" />
  <link rel="import" href="/external/iron-location/iron-query-params.html" />

  <!-- App elements -->
  <link rel = "import" href = "/elements/ffo-app.html" />
</head>

<body>
<template is="dom-bind" id="pageTemplate">

  <iron-location
    path="{{path}}" hash="{{hash}}" query="{{query}}" >
  </iron-location>

  <iron-query-params
    params-string="[[query]]" params-object="{{params}}">
  </iron-query-params>

  <template is="dom-if" if="[[!params.id]]">
    <h2>Hmm, Looks like we got an invalid room id!</h2>
  </template>

  <template is="dom-if" if="[[params.id]]">
    <template is="dom-if" if="[[needUserName]]">
      <div class="container">
        <input id="username" type="text" />
        <button>Go!</button>
      </div>
    </template>


    <template is="dom-if" if="[[!needUserName]]">
      <ffo-app room="[[room]]"></ffo-app>
    </template>
  </template>

</template>


  <!-- Application javascript goes here. -->
  <script type="text/javascript">
    window.addEventListener("WebComponentsReady", function(e) {
      var pageTemplate = document.getElementById("pageTemplate");
      var cookie = document.cookie;

      if (cookie != "") {
        pageTemplate.needUserName = false;
      } else {
        pageTemplate.needUserName = true;
        document.cookie = "ABC123"
      }

      var socket = io();
      socket.on("update-room", function(msg){
        pageTemplate.room = JSON.parse(msg);
      });
    });

  </script>


</body>
</html>