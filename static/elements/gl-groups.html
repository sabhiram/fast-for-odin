<link rel = "import" href = "/external/polymer/polymer.html">
<link rel = "import" href = "/external/iron-ajax/iron-request.html" />

<!-- gl-groups -->
<dom-module id="gl-groups">

  <!-- HTML & Markup -->
  <template>
    <div id="container">
      <template is="dom-repeat" items="[[ groups ]]" as="group">
        <h1>Group Name: [[ group.name ]]</h1>
        <gl-group-projects
          group-id="[[ group.id ]]">
        </gl-group-projects>
      </template>
    </div>
  </template>

  <!-- Brains -->
  <script>
  (function() {
    'use strict';

    Polymer({
      is: 'gl-groups',

      properties: {
        groups: {
          type: Array,
          notify: true,
        },
      },

      ready: function() {
        var request_promise = (document.createElement("iron-request"));

        request_promise.send({
          url:    "/api/groups",
          method: "GET",
        });

        request_promise.completes.then(function(value) {
          var data = JSON.parse(value.response);
          this.set("groups", data);
        }.bind(this)).catch(function(error) {
          console.log("Error: " + error);
        }.bind(this));
      },

    });
  })();
  </script>
</dom-module>

<!-- gl-group-projects -->
<dom-module id="gl-group-projects">

  <!-- HTML & Markup -->
  <template>
    <div id="container">
      <template is="dom-repeat" items="[[ projects ]]" as="project">
        <p>Project Name: [[ project.name ]]<p>
      </template>
    </div>
  </template>

  <!-- Brains -->
  <script>
  (function() {
    'use strict';

    Polymer({
      is: 'gl-group-projects',

      properties: {
        groupId: {
          type: String,
        },
        projects: {
          type: Array,
          notify: true,
        },
      },

      observers: [
        "_loadProjects(groupId)"
      ],

      _loadProjects: function(groupId) {
        var request_promise = (document.createElement("iron-request"));

        request_promise.send({
          url:    "/api/projects/" + this.groupId,
          method: "GET",
        });

        request_promise.completes.then(function(value) {
          console.log("VALUE")
          console.log(value.response)
          var data = JSON.parse(value.response);
          this.set("projects", data);
        }.bind(this)).catch(function(error) {
          console.log("Error: " + error);
        }.bind(this));
      },

      ready: function() {},

    });
  })();
  </script>
</dom-module>